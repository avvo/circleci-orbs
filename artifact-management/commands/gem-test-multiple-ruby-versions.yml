description: Perform gem test with many versions of Ruby
parameters:
  gem_test_dir:
    description: The directory in which the gem tesets should run
    type: string
    default: .
  test_command:
     default: bundle exec rake test
     description: The command that should be used to run tests
     type: string
  ruby_versions:
    description: The ruby versions to be used to test the gem.
    type: string
    default: "2.2.10,2.3.8,2.4.10,2.5.8,2.6.6,2.7.1"
steps:
  - setup-gem-environment
  - gem-test-common-steps
  - run:
      name: bundle install
      command: |-
        cd <<parameters.gem_test_dir>>
        rvm <<parameters.ruby_versions>> do bundle install
  - run:
      name: Run tests
      command: |-
        cd <<parameters.gem_test_dir>>
        rvm <<parameters.ruby_versions>> do <<parameters.test_command>>
  - teardown-gem-environment
